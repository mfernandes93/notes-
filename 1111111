Com base na sua solicita√ß√£o e nos documentos analisados, aqui est√° a **Documenta√ß√£o Unificada do Projeto de Migra√ß√£o CNPJ Alfanum√©rico**, ajustada para a premissa de que a responsabilidade por adapta√ß√µes externas recai sobre os parceiros/consumidores.

---

# üìò Projeto de Implementa√ß√£o: CNPJ Alfanum√©rico (Mobius CCRP)

## 1. Vis√£o Geral e O Desafio
[cite_start]A partir de 2026, o padr√£o de CNPJ brasileiro mudar√° de exclusivamente num√©rico (apenas d√≠gitos) para alfanum√©rico (letras e n√∫meros)[cite: 3].
[cite_start]O ecossistema atual do Mobius CCRP foi constru√≠do sob a premissa r√≠gida de que o identificador "CNPJ" cont√©m apenas n√∫meros[cite: 4].
[cite_start]**O Problema:** Se o sistema receber um c√≥digo com letras hoje (ex: "12.ABC..."), ele tentar√° realizar c√°lculos matem√°ticos ou formata√ß√µes num√©ricas, causando erros fatais ("Crash") na aplica√ß√£o[cite: 5, 13].

[cite_start]**O Objetivo:** Realizar uma mudan√ßa de paradigma, ensinando o sistema a tratar o CNPJ estritamente como **Texto (String)**, garantindo que ele aceite o novo formato sem travar e mantenha o funcionamento dos contratos atuais[cite: 23, 6].

---

## 2. Estrat√©gia de Fases

O projeto ser√° executado em 4 fases l√≥gicas para garantir a seguran√ßa da opera√ß√£o.

### **Fase 1: Infraestrutura de Dados (Blindagem)**
* **Foco:** Banco de Dados e Hist√≥rico.
* **O que ser√° feito:** O banco de dados precisa saber diferenciar e buscar letras sem causar duplicidade (ex: garantir que "abc" e "ABC" sejam o mesmo cliente). [cite_start]Criaremos uma estrutura "espelho" normalizada para buscas e adaptaremos o hist√≥rico existente[cite: 17, 21].
* **Complexidade:** Alta (envolve manipula√ß√£o de massa de dados).

### **Fase 2: Refatora√ß√£o do Core (Seguran√ßa e Anti-Crash)**
* **Foco:** O "C√©rebro" do Sistema (Backend Mobius).
* **O que ser√° feito:** √â a fase mais cr√≠tica. Envolve "operar" o cora√ß√£o do sistema para remover qualquer l√≥gica que trate CNPJ como n√∫mero (matem√°tica). [cite_start]Substituiremos as regras de valida√ß√£o (D√≠gito Verificador) e de formata√ß√£o (m√°scaras de pontos e tra√ßos) por vers√µes que aceitem texto[cite: 44, 46].
* **Complexidade:** Cr√≠tica (risco de parar a opera√ß√£o se houver erro).

### **Fase 3: Fronteiras e Contratos (Publica√ß√£o)**
* **Foco:** APIs e Comunica√ß√£o Externa.
* **O que ser√° feito:** Atualizar as "portas de entrada e sa√≠da" (APIs, Swagger, Mensageria). Definiremos explicitamente nos contratos t√©cnicos que o campo agora aceita letras.
* **Responsabilidade:** Garantir que o Mobius aceite receber e saiba enviar o dado novo. [cite_start]Se o sistema vizinho (parceiro/consumidor) n√£o estiver pronto para ler esse dado, o erro ser√° tratado do lado dele[cite: 33, 78].
* **Complexidade:** M√©dia (ajuste de contratos e valida√ß√µes de entrada).

### **Fase 4: Estabiliza√ß√£o (Qualidade)**
* **Foco:** Performance e Garantia.
* [cite_start]**O que ser√° feito:** Testes de carga para garantir que a troca de √≠ndices num√©ricos por textuais n√£o deixou o sistema lento, e monitoramento para assegurar que a opera√ß√£o segue fluida[cite: 53, 55].
* **Complexidade:** M√©dia.

---

## 3. Backlog Detalhado por Componente

Abaixo, o detalhamento do trabalho t√©cnico necess√°rio, classificado por componente e complexidade.

### üóÑÔ∏è Componente: Banco de Dados (SQL Server)

| Item de Trabalho | Complexidade | Por que fazer isso? |
| :--- | :--- | :--- |
| **Criar Coluna Normalizada (`DOCUMENTO_NORM`)** | üî¥ Alta | [cite_start]O banco precisa de um local dedicado para salvar o CNPJ "limpo" (sem pontos, tudo mai√∫sculo) para garantir buscas r√°pidas e unicidade[cite: 19, 20]. |
| **Rodar Script de Carga (Backfill)** | üî¥ Alta | [cite_start]√â necess√°rio preencher essa nova coluna para todo o hist√≥rico de clientes (milh√µes de registros), permitindo que o sistema busque antigos e novos da mesma forma[cite: 42, 62]. |
| **Remover Filtros Num√©ricos (`ISNUMERIC`)** | üü° M√©dia | Existem scripts no banco que rejeitam dados que n√£o s√£o n√∫meros. [cite_start]Precisamos remover essas travas para permitir a grava√ß√£o dos alfanum√©ricos[cite: 65]. |

### üß† Componente: Backend (Mobius Core / Aplica√ß√£o)

| Item de Trabalho | Complexidade | Por que fazer isso? |
| :--- | :--- | :--- |
| **Refatorar Validador Mestre (`TestaCPFCNPJ`)** | üî¥ Cr√≠tica | Este √© o m√©todo que diz se um cadastro √© v√°lido. [cite_start]Ele deve ser reescrito para: se for num√©rico, valida a conta antiga; se for alfanum√©rico, valida apenas se tem 14 caracteres[cite: 68, 69]. |
| **Remover Convers√£o Decimal (`Anti-Crash`)** | üî¥ Cr√≠tica | Hoje o sistema converte o CNPJ em valor decimal para colocar pontos. Com letras, isso gera um erro fatal (`Crash`). [cite_start]A l√≥gica deve mudar para manipula√ß√£o de texto apenas[cite: 13, 71]. |
| **Atualizar Entidades de Dom√≠nio** | üü† Alta | [cite_start]Revis√£o de mais de 30 arquivos de classes (Modelos) para garantir que a propriedade "CNPJ" seja tratada como Texto e normalizada (Mai√∫sculas) ao ser criada[cite: 10, 74]. |
| **Ajustar Formata√ß√£o de E-mails** | üü° M√©dia | Os e-mails enviados pelo sistema formatam o CNPJ antes do disparo. [cite_start]Essa formata√ß√£o precisa aceitar letras para n√£o travar o envio de notifica√ß√µes[cite: 752, 892]. |

### üåê Componente: Interfaces e API (BFF - Onboarding)

*Contexto Fase 3: Garantia do nosso contrato.*

| Item de Trabalho | Complexidade | Por que fazer isso? |
| :--- | :--- | :--- |
| **Ajustar Contratos de Entrada (DTOs)** | üü° M√©dia | As APIs (BFF) hoje bloqueiam requisi√ß√µes que cont√™m letras. [cite_start]Precisamos alterar a valida√ß√£o de entrada para aceitar string de 14 caracteres, permitindo que o dado chegue ao backend[cite: 79]. |
| **Atualizar Documenta√ß√£o (Swagger/Schemas)** | üü¢ Baixa | Atualizar o manual t√©cnico da API e os esquemas de mensagens (Kafka/Avro) para explicitar que o campo √© `String`. [cite_start]Isso oficializa a mudan√ßa para quem consome nossos dados[cite: 33, 84]. |
| **Remover M√°scaras de Resposta** | üü° M√©dia | [cite_start]Ao devolver dados para o Frontend ou parceiros, garantir que o JSON de resposta envie o dado sem tentar aplicar a m√°scara num√©rica antiga[cite: 113, 115]. |

### ü§ñ Componente: Rob√¥s (RPA/Automa√ß√£o)

| Item de Trabalho | Complexidade | Por que fazer isso? |
| :--- | :--- | :--- |
| **Input de Texto Puro** | üü° M√©dia | [cite_start]Alterar o rob√¥ para "colar" o texto do CNPJ diretamente nos sites externos, removendo qualquer tentativa do rob√¥ de formatar ou validar matematicamente antes de digitar[cite: 89, 90]. |
| **Captura de Erros Web** | üü¢ Baixa | [cite_start]Preparar o rob√¥ para ler mensagens de erro na tela do site externo (ex: "Formato Inv√°lido"), para diferenciar falha do rob√¥ de rejei√ß√£o do site[cite: 91]. |
