name: migração-cnpj-alfanumerico
description: >
  Validação e adequação do CNPJ alfanumérico (novo formato oficial no Brasil a partir de 2026).
  O objetivo é garantir compatibilidade com sistemas legados, validação de entrada e consistência em banco de dados.

inputs:
  - name: cnpj
    type: string
    description: >
      CNPJ alfanumérico com 14 posições fixas:
      - As 12 primeiras posições aceitam [A-Z0-9].
      - As 2 últimas posições são dígitos numéricos (DV).
    validations:
      - regex: "^[A-Z0-9]{12}[0-9]{2}$"
        error_message: "CNPJ inválido. Deve conter 14 caracteres, sendo 12 alfanuméricos + 2 dígitos finais."
      - length: 14
        error_message: "CNPJ deve ter exatamente 14 caracteres."

tasks:
  - name: validar-digito-verificador
    description: >
      Aplica regra do Módulo 11 no cálculo do DV.
      - Considerar pesos tradicionais do CNPJ.
      - Para letras, converter para valor numérico base 36 (A=10, B=11, ..., Z=35).
      - Validar os 2 últimos dígitos com base nesse cálculo.
    implementation: |
      # Exemplo em pseudocódigo
      function validarDV(cnpj):
          base = cnpj[0:12]
          dv_informado = cnpj[12:14]
          dv_calculado = modulo11(base, pesos)
          return dv_informado == dv_calculado

  - name: sanitizar-input
    description: >
      Remove espaços, caracteres especiais e converte para maiúsculo
      antes de aplicar validações e persistência no banco.
    implementation: |
      # Pseudocódigo
      cnpj = Regex.Replace(cnpj, "[^A-Za-z0-9]", "").ToUpper()

outputs:
  - name: cnpj_valido
    type: boolean
    description: Indica se o CNPJ informado passou em todas as validações.
